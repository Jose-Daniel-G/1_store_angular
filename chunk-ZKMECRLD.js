import{a as pe}from"./chunk-LP3ZXZHP.js";import{a as ge}from"./chunk-WY3AK3IM.js";import{a as ce}from"./chunk-EK5HOP4N.js";import{a as $,b as N,c as H,d as J,e as V,g as L,h as B,n as G,o as ue,p as fe}from"./chunk-NAB4HAM6.js";import{c as y,d as F,e as se,f as A,g as ae,h as le,i as me,n as de,p as k,q as M,s as Y}from"./chunk-LM5SF62Y.js";import{Aa as a,Ba as d,Ma as c,P as j,Pa as l,Q as O,Ra as n,Sa as o,Ta as E,U as re,Ua as W,Va as X,Wa as P,Z as I,Za as u,_ as T,_a as p,ab as s,bb as f,cb as h,fb as g,ga as C,gb as oe,ha as x,hb as b,i as ee,ib as R,j as te,jb as ne,n as ie,y as _}from"./chunk-TIETC33F.js";var v=class i{constructor(t){this.http=t}apiUrl=`${ce.URL_SERVICIOS}`;rolesEndpoint=`${this.apiUrl}/roles`;permissionsEndpoint=`${this.apiUrl}/permissions`;getAuthHeaders(){return new le({"Content-Type":"application/json",Accept:"application/json"})}handleError(t){let e="An unknown error occurred!";if(t.error instanceof ErrorEvent)e=`Error: ${t.error.message}`;else if(console.error(`Backend returned code ${t.status}, body was: ${JSON.stringify(t.error)}`),e=`Error ${t.status}: ${t.error?.message||t.statusText}`,t.error?.errors){let r=Object.values(t.error.errors).flat().join("; ");e+=`
Validation Details: ${r}`}return ie(()=>new Error(e))}getRoles(t=1,e=10){return this.http.get(`${this.rolesEndpoint}?page=${t}&per_page=${e}`,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}getRole(t){return this.http.get(`${this.rolesEndpoint}/${t}`,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}getPermissions(){return this.http.get(`${this.permissionsEndpoint}`,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}createRole(t){return this.http.post(this.rolesEndpoint,t,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}updateRole(t,e){return this.http.put(`${this.rolesEndpoint}/${t}`,e,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}deleteRole(t){return this.http.delete(`${this.rolesEndpoint}/${t}`,{headers:this.getAuthHeaders()}).pipe(_(this.handleError))}static \u0275fac=function(e){return new(e||i)(re(me))};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var xe=()=>["/roles"];function Ee(i,t){i&1&&(n(0,"div",18),s(1," Cargando permisos disponibles o no hay permisos. "),o())}function Pe(i,t){if(i&1){let e=P();n(0,"div",19)(1,"input",20),u("change",function(m){let S=C(e).$implicit,Q=p();return x(Q.handlePermissionCheckboxChange(S.id,m))}),o(),n(2,"label",21),s(3),o()()}if(i&2){let e=t.$implicit,r=p();a(),l("id","permission-"+e.id)("checked",r.isPermissionSelected(e.id)),a(),l("for","permission-"+e.id),a(),h(" ",e.name," ")}}function Re(i,t){if(i&1&&(n(0,"div",22)(1,"h5"),s(2,"Permisos Disponibles (permissions):"),o(),n(3,"pre")(4,"code",23),s(5),b(6,"json"),o()(),n(7,"h5",24),s(8,"IDs de Permisos Seleccionados (selectedPermissionIds):"),o(),n(9,"pre")(10,"code",23),s(11),b(12,"json"),o()()()),i&2){let e=p();a(5),f(R(6,2,e.permissions)),a(6),f(R(12,4,e.selectedPermissionIds))}}var U=class i{constructor(t,e,r,m){this.fb=t;this.roleService=e;this.permissionService=r;this.router=m}roleForm;permissions=[];selectedPermissionIds=[];showDebugJson=!1;ngOnInit(){this.roleForm=this.fb.group({name:["",N.required],guard_name:["web"]}),this.loadPermissions()}loadPermissions(){this.permissionService.getPermissions().subscribe({next:t=>{this.permissions=t.data},error:t=>{console.error("Error loading permissions:",t),this.permissions=[]}})}handlePermissionCheckboxChange(t,e){let r=e.target.checked;this.updateSelectedPermissions(t,r)}updateSelectedPermissions(t,e){e?this.selectedPermissionIds.push(t):this.selectedPermissionIds=this.selectedPermissionIds.filter(r=>r!==t),console.log("Permisos seleccionados:",this.selectedPermissionIds)}isPermissionSelected(t){return this.selectedPermissionIds.includes(t)}toggleDebugJson(){this.showDebugJson=!this.showDebugJson}onSubmit(){if(this.roleForm.valid){let t={name:this.roleForm.value.name,guard_name:this.roleForm.value.guard_name,permissions:this.selectedPermissionIds};this.roleService.createRole(t).subscribe({next:e=>{console.log("Rol creado:",e),this.router.navigate(["/dashboard/roles"])},error:e=>{console.error("Error al crear rol:",e)}})}}static \u0275fac=function(e){return new(e||i)(d(G),d(v),d(ge),d(k))};static \u0275cmp=I({type:i,selectors:[["app-role-create"]],decls:25,vars:8,consts:[[1,"container-fluid"],[1,"card","card-primary"],[1,"card-header"],[1,"card-title"],[3,"ngSubmit","formGroup"],[1,"card-body"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","placeholder","Nombre del Rol",1,"form-control"],[1,"form-group","mt-4"],["class","alert alert-info",4,"ngIf"],["class","form-check",4,"ngFor","ngForOf"],[1,"card-footer"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"btn","btn-secondary","ml-2",3,"routerLink"],[1,"card-footer","mt-4"],[1,"btn","btn-info","btn-sm",3,"click"],["class","mt-3 p-3 bg-light border rounded",4,"ngIf"],[1,"alert","alert-info"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"mt-3","p-3","bg-light","border","rounded"],[2,"white-space","pre-wrap","word-break","break-all"],[1,"mt-3"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),s(4,"Crear Nuevo Rol"),o()(),n(5,"form",4),u("ngSubmit",function(){return r.onSubmit()}),n(6,"div",5)(7,"div",6)(8,"label",7),s(9,"Nombre del Rol"),o(),E(10,"input",8),o(),n(11,"div",9)(12,"label"),s(13,"Asignar Permisos:"),o(),c(14,Ee,2,0,"div",10)(15,Pe,4,4,"div",11),o()(),n(16,"div",12)(17,"button",13),s(18,"Crear Rol"),o(),n(19,"a",14),s(20,"Cancelar"),o()()(),n(21,"div",15)(22,"button",16),u("click",function(){return r.toggleDebugJson()}),s(23),o(),c(24,Re,13,6,"div",17),o()()()),e&2&&(a(5),l("formGroup",r.roleForm),a(9),l("ngIf",r.permissions.length===0),a(),l("ngForOf",r.permissions),a(2),l("disabled",r.roleForm.invalid),a(2),l("routerLink",g(7,xe)),a(4),h(" ",r.showDebugJson?"Ocultar JSON de Depuraci\xF3n":"Mostrar JSON de Depuraci\xF3n"," "),a(),l("ngIf",r.showDebugJson))},dependencies:[y,F,M,V,$,H,J,L,B,A]})};var w=class i{confirmationSubject=new te(null);confirmation$=this.confirmationSubject.asObservable();confirmActionSubject=new ee;constructor(){}openConfirmation(t){return this.confirmationSubject.next({show:!0,message:t}),new Promise(e=>{let r=this.confirmActionSubject.subscribe(m=>{e(m),r.unsubscribe(),this.closeConfirmation()})})}onConfirm(){this.confirmActionSubject.next(!0)}onCancel(){this.confirmActionSubject.next(!1)}closeConfirmation(){this.confirmationSubject.next(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};var ye=()=>[],Fe=()=>["/dashboard/roles"];function ke(i,t){i&1&&(n(0,"div",19),s(1," El nombre es requerido. "),o())}function Me(i,t){i&1&&(n(0,"div",20),s(1," Cargando permisos disponibles o no hay permisos. "),o())}function De(i,t){if(i&1){let e=P();n(0,"div",21)(1,"input",22),u("change",function(m){let S=C(e).$implicit,Q=p();return x(Q.handlePermissionCheckboxChange(S.id,m))}),o(),n(2,"label",23),s(3),o()()}if(i&2){let e=t.$implicit,r=p();a(),l("id","permission-"+e.id)("checked",r.isPermissionSelected(e.id)),a(),l("for","permission-"+e.id),a(),h(" ",e.name," ")}}function we(i,t){if(i&1&&(n(0,"div",24)(1,"h5"),s(2,"Permisos Disponibles (availablePermissions):"),o(),n(3,"pre")(4,"code",25),s(5),b(6,"json"),o()(),n(7,"h5",26),s(8,"IDs de Permisos Seleccionados (selectedPermissionIds):"),o(),n(9,"pre")(10,"code",25),s(11),b(12,"json"),o()()()),i&2){let e=p();a(5),f(R(6,2,e.availablePermissions)),a(6),f(R(12,4,e.selectedPermissionIds))}}var q=class i{constructor(t,e,r,m,S){this.fb=t;this.route=e;this.roleService=r;this.router=m;this.modalService=S;this.editRoleForm=this.fb.group({name:["",N.required],guard_name:["web",N.required]})}editRoleForm;roleId=null;errorMessage="";successMessage="";availablePermissions=[];selectedPermissionIds=[];showDebugJson=!1;ngOnInit(){this.roleId=Number(this.route.snapshot.paramMap.get("id")),this.roleService.getPermissions().subscribe({next:t=>{this.availablePermissions=t.data.data||[],console.log("Permisos disponibles cargados:",this.availablePermissions),this.roleId&&this.loadRoleData(this.roleId)},error:t=>{console.error("Error al cargar permisos disponibles:",t),this.errorMessage=t.error?.message||"Error al cargar los permisos disponibles."}})}loadRoleData(t){this.roleService.getRole(t).subscribe({next:e=>{console.log("Datos del rol cargados:",e),this.editRoleForm.patchValue({name:e.name,guard_name:e.guard_name}),e.permissions&&e.permissions.length>0?(this.selectedPermissionIds=e.permissions.map(r=>r.id),console.log("Permisos preseleccionados para el rol:",this.selectedPermissionIds)):(this.selectedPermissionIds=[],console.log("El rol no tiene permisos asignados o la propiedad permissions est\xE1 vac\xEDa."))},error:e=>{console.error("Error al cargar rol:",e),this.errorMessage=e.error?.message||"Error al cargar el rol."}})}onPermissionChange(t,e){e?this.selectedPermissionIds.includes(t)||this.selectedPermissionIds.push(t):this.selectedPermissionIds=this.selectedPermissionIds.filter(r=>r!==t),console.log("Permisos seleccionados:",this.selectedPermissionIds)}isPermissionSelected(t){return this.selectedPermissionIds.includes(t)}handlePermissionCheckboxChange(t,e){let r=e.target.checked;this.onPermissionChange(t,r)}toggleDebugJson(){this.showDebugJson=!this.showDebugJson}onSubmit(){if(this.errorMessage="",this.successMessage="",this.editRoleForm.invalid||!this.roleId){this.errorMessage="Por favor, completa todos los campos requeridos y aseg\xFArate de que el ID del rol es v\xE1lido.",this.editRoleForm.markAllAsTouched();return}let t={name:this.editRoleForm.value.name,guard_name:this.editRoleForm.value.guard_name,permission:this.selectedPermissionIds};console.log("Enviando payload de actualizaci\xF3n:",t),this.roleService.updateRole(this.roleId,t).subscribe({next:e=>{this.successMessage=e.message||"Rol actualizado exitosamente.",console.log("Respuesta de actualizaci\xF3n de rol:",e),this.router.navigate(["/dashboard/roles"])},error:e=>{if(console.error("Error al actualizar rol:",e),this.errorMessage=e.error?.message||"Error al actualizar el rol.",e.error?.errors)for(let r in e.error.errors)this.errorMessage+=`
${e.error.errors[r].join(", ")}`}})}static \u0275fac=function(e){return new(e||i)(d(G),d(de),d(v),d(k),d(w))};static \u0275cmp=I({type:i,selectors:[["app-edit-role"]],decls:26,vars:10,consts:[[1,"container-fluid"],[1,"card","card-primary"],[1,"card-header"],[1,"card-title"],[3,"ngSubmit","formGroup"],[1,"card-body"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","placeholder","Nombre del Rol",1,"form-control"],["class","text-danger",4,"ngIf"],[1,"form-group","mt-4"],["class","alert alert-info",4,"ngIf"],["class","form-check",4,"ngFor","ngForOf"],[1,"card-footer"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"btn","btn-secondary","ml-2",3,"routerLink"],[1,"card-footer","mt-4"],[1,"btn","btn-info","btn-sm",3,"click"],["class","mt-3 p-3 bg-light border rounded",4,"ngIf"],[1,"text-danger"],[1,"alert","alert-info"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label",3,"for"],[1,"mt-3","p-3","bg-light","border","rounded"],[2,"white-space","pre-wrap","word-break","break-all"],[1,"mt-3"]],template:function(e,r){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),s(4,"Editar Rol"),o()(),n(5,"form",4),u("ngSubmit",function(){return r.onSubmit()}),n(6,"div",5)(7,"div",6)(8,"label",7),s(9,"Nombre del Rol"),o(),E(10,"input",8),c(11,ke,2,0,"div",9),o(),n(12,"div",10)(13,"label"),s(14,"Permisos:"),o(),c(15,Me,2,0,"div",11)(16,De,4,4,"div",12),o()(),n(17,"div",13)(18,"button",14),s(19,"Actualizar"),o(),n(20,"a",15),s(21,"Cancelar"),o()()(),n(22,"div",16)(23,"button",17),u("click",function(){return r.toggleDebugJson()}),s(24),o(),c(25,we,13,6,"div",18),o()()()),e&2){let m;a(5),l("formGroup",r.editRoleForm),a(6),l("ngIf",((m=r.editRoleForm.get("name"))==null?null:m.invalid)&&(((m=r.editRoleForm.get("name"))==null?null:m.dirty)||((m=r.editRoleForm.get("name"))==null?null:m.touched))),a(4),l("ngIf",!r.availablePermissions||r.availablePermissions.length===0),a(),l("ngForOf",r.availablePermissions||g(8,ye)),a(2),l("disabled",r.editRoleForm.invalid),a(2),l("routerLink",g(9,Fe)),a(4),h(" ",r.showDebugJson?"Ocultar JSON de Depuraci\xF3n":"Mostrar JSON de Depuraci\xF3n"," "),a(),l("ngIf",r.showDebugJson)}},dependencies:[y,F,M,V,$,H,J,L,B,A]})};var Se=()=>[],Ne=()=>["/roles/create"],je=i=>["/roles",i,"edit"];function Oe(i,t){i&1&&(n(0,"a",13),s(1,"Crear nuevo rol"),o()),i&2&&l("routerLink",g(1,Ne))}function Te(i,t){if(i&1&&(n(0,"li"),s(1),o()),i&2){let e=t.$implicit;a(),h(" ",e.name," ")}}function Ae(i,t){if(i&1&&(W(0),n(1,"ul"),c(2,Te,2,1,"li",10),o(),X()),i&2){let e=p().$implicit;a(2),l("ngForOf",e.permissions||g(1,Se))}}function $e(i,t){i&1&&(W(0),s(1," No permissions assigned. "),X())}function He(i,t){if(i&1&&(n(0,"a",16),s(1,"Editar"),o()),i&2){let e=p().$implicit;l("routerLink",oe(1,je,e.id))}}function Je(i,t){if(i&1){let e=P();n(0,"button",17),u("click",function(){C(e);let m=p().$implicit,S=p();return x(S.confirmDeleteRole(m.id))}),s(1,"Eliminar"),o()}}function Ve(i,t){if(i&1&&(n(0,"tr")(1,"td"),s(2),o(),n(3,"td"),s(4),o(),n(5,"td"),c(6,Ae,3,2,"ng-container",11)(7,$e,2,0,"ng-container",11),o(),n(8,"td"),s(9),b(10,"date"),o(),n(11,"td",9),c(12,He,2,3,"a",14)(13,Je,2,0,"button",15),o()()),i&2){let e=t.$implicit,r=p();a(2),f(e.id),a(2),f(e.name),a(2),l("ngIf",e.permissions&&e.permissions.length>0),a(),l("ngIf",!e.permissions||e.permissions.length===0),a(2),f(ne(10,7,e.created_at,"dd MMM, y")),a(3),l("ngIf",r.checkPermission("roles.edit")),a(),l("ngIf",r.checkPermission("roles.destroy"))}}function Le(i,t){i&1&&(n(0,"tr")(1,"td",18),s(2,"No hay roles registrados."),o()())}function Be(i,t){i&1&&E(0,"div",19)}var z=class i{constructor(t,e,r,m){this.roleService=t;this.router=e;this.authService=r;this.modalService=m}roles=[];errorMessage="";successMessage="";totalItems=0;itemsPerPage=10;currentPage=1;showConfirmationModal=!1;modalMessage="";roleToDeleteId=null;ngOnInit(){this.loadRoles()}loadRoles(){this.errorMessage="",this.roleService.getRoles(this.currentPage,this.itemsPerPage).subscribe({next:t=>{console.log("API Response:",t),this.roles=t.data||[],this.totalItems=t.total,this.currentPage=t.current_page,this.itemsPerPage=t.per_page},error:t=>{console.error("Error al cargar roles:",t),this.errorMessage=t.error?.message||"Error al cargar los roles.",this.roles=[]}})}confirmDeleteRole(t){this.roleToDeleteId=t,this.modalService.openConfirmation("\xBFEst\xE1s seguro de que deseas eliminar este rol? Esta acci\xF3n no se puede deshacer.").then(e=>{e&&this.roleToDeleteId!==null&&this.deleteRole(this.roleToDeleteId),this.roleToDeleteId=null})}deleteRole(t){this.errorMessage="",this.successMessage="",this.roleService.deleteRole(t).subscribe({next:e=>{this.successMessage=e.message||"Rol eliminado exitosamente.",this.loadRoles()},error:e=>{console.error("Error al eliminar rol:",e),this.errorMessage=e.error?.message||"Error al eliminar el rol."}})}getPermissionNames(t){return(t||[]).map(e=>e.name).join(", ")}onPageChange(t){this.currentPage=t,this.loadRoles()}editRole(t){this.router.navigate(["/dashboard/roles",t,"edit"])}checkPermission(t){return this.authService.hasPermission(t)}static \u0275fac=function(e){return new(e||i)(d(v),d(k),d(pe),d(w))};static \u0275cmp=I({type:i,selectors:[["app-roles-index"]],decls:25,vars:5,consts:[[1,"container-fluid"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["class","btn btn-sm btn-primary",3,"routerLink",4,"ngIf"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","card-footer",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["class","btn btn-sm btn-outline-dark me-2",3,"routerLink",4,"ngIf"],["class","btn btn-sm btn-danger",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-outline-dark","me-2",3,"routerLink"],[1,"btn","btn-sm","btn-danger",3,"click"],["colspan","5",1,"text-center"],[1,"card-footer"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),s(4,"Lista de Roles"),o(),c(5,Oe,2,2,"a",4),o(),n(6,"div",5)(7,"div",6)(8,"table",7)(9,"thead",8)(10,"tr")(11,"th"),s(12,"#"),o(),n(13,"th"),s(14,"Nombre"),o(),n(15,"th"),s(16,"Permisos"),o(),n(17,"th"),s(18,"Creaci\xF3n"),o(),n(19,"th",9),s(20,"Acci\xF3n"),o()()(),n(21,"tbody"),c(22,Ve,14,10,"tr",10)(23,Le,3,0,"tr",11),o()()()(),c(24,Be,1,0,"div",12),o()()),e&2&&(a(5),l("ngIf",r.checkPermission("roles.create")),a(17),l("ngForOf",r.roles||g(4,Se)),a(),l("ngIf",!r.roles||r.roles.length===0),a(),l("ngIf",r.totalItems>0&&r.totalItems>r.itemsPerPage))},dependencies:[y,F,M,se]})};var Ge=[{path:"",component:z},{path:"create",component:U},{path:":id/edit",component:q}],K=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=T({type:i});static \u0275inj=O({imports:[Y.forChild(Ge),Y]})};var Ie=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=T({type:i});static \u0275inj=O({imports:[ae,K,fe,ue]})};export{Ie as RolesModule};
